// Generated by CoffeeScript 1.9.3
(function() {
  window.Timechart = (function() {
    var _args, _downedBlock, _selectingBlock, _timechartParent, _timechartPressing, _viewColor;

    _args = {};

    _timechartPressing = false;

    _downedBlock = null;

    _selectingBlock = [];

    _timechartParent = null;

    _viewColor = ["#2699BF", "#B5D145", "#F5CC38", "#F1BC39", "#E68840", "#D2495B"];

    function Timechart(args1, form_cancel, form_submit) {
      this.args = args1;
      $(function() {
        var $timechartBlock, $timechartViewBlock, _form_cancel, _form_submit, hour, i, l, m, min;
        _args = args;
        for (i = l = 0; l < 60; i = ++l) {
          $timechartBlock = $('<div class="timechart-block"></div>');
          $timechartBlock.addClass("timechart-block-" + i);
          $timechartBlock.attr("data-toggle", "tooltip");
          hour = Math.floor(i / 12 + 10) + ":";
          min = String(i % 12 * 5);
          if (min.length === 1) {
            min = "0" + min;
          }
          $timechartBlock.attr("title", hour + min);
          if (i % 12 === 11) {
            $timechartBlock.addClass("timechart-block-hour");
          }
          $timechartBlock.mousedown(function() {
            var j, k, m, n;
            _selectingBlock = [];
            $(".timechart-pop").popover("hide").remove();
            _timechartParent = $(this).parent();
            for (j = m = 0; m < 60; j = ++m) {
              _timechartParent.children(".timechart-block-" + j).removeClass("timechart-block-selecting");
            }
            _timechartPressing = true;
            for (j = n = 0; n < 60; j = ++n) {
              if ($(this).hasClass("timechart-block-" + j)) {
                k = j;
              }
            }
            _selectingBlock.push(k);
            _downedBlock = k;
            return $(this).addClass("timechart-block-selecting");
          });
          $timechartBlock.hover(function() {
            var j, k, m, results;
            if (!_timechartPressing) {
              return;
            }
            _selectingBlock = [];
            j = 0;
            results = [];
            for (k = m = 0; m < 60; k = ++m) {
              if (j >= 2) {
                j++;
              }
              if ($(this).hasClass("timechart-block-" + k)) {
                j++;
              }
              if (k === _downedBlock) {
                j++;
              }
              if (j === 1 || j === 2) {
                _timechartParent.children(".timechart-block-" + k).addClass("timechart-block-selecting");
                results.push(_selectingBlock.push(k));
              } else {
                results.push(_timechartParent.children(".timechart-block-" + k).removeClass("timechart-block-selecting"));
              }
            }
            return results;
          });
          $("*").mouseup(function() {
            var $timechartPop, j, pos, time;
            if (!_timechartPressing) {
              return;
            }
            time = $(_timechartParent).children(".timechart-block-" + _selectingBlock[0]).attr("data-original-title").split(":");
            $("#form-start-hour").attr("value", time[0]);
            $("#form-start-min").attr("value", time[1]);
            $("#form-event-hour").attr("value", time[0]);
            $("#form-event-min").attr("value", time[1]);
            time = $(_timechartParent).children(".timechart-block-" + _selectingBlock[_selectingBlock.length - 1]).attr("data-original-title").split(":");
            $("#form-finish-hour").attr("value", time[0]);
            $("#form-finish-min").attr("value", time[1]);
            $timechartPop = $('<div class="timechart-pop"></div>');
            j = _selectingBlock[Math.floor(_selectingBlock.length / 2)];
            $(_timechartParent).children(".timechart-block-" + j).after($timechartPop);
            pos = $(_timechartParent).children(".timechart-block-" + j).position();
            $timechartPop.css("top", pos.top).css("left", pos.left + (_selectingBlock.length % 2 === 1 ? $(".timechart-block").width() / 2 : 0)).popover({
              html: true,
              placement: "bottom",
              animation: false,
              trigger: "focus",
              content: function() {
                return $("#popover-content-original").html();
              }
            });
            $timechartPop.popover("show");
            $("#form-cancel").click(_form_cancel);
            $("#form-submit").click(_form_submit);
            $("#collapse-body").on("hide.bs.collapse", _form_cancel);
            _timechartPressing = false;
            return _selectingBlock = [];
          });
          $(".timechart").append($timechartBlock);
        }
        for (i = m = 0; m < 60; i = ++m) {
          $timechartViewBlock = $('<div class="timechart-view-block"></div>');
          $timechartViewBlock.addClass("timechart-view-block-" + i);
          if (i % 12 === 11) {
            $timechartViewBlock.addClass("timechart-view-block-hour");
          }
          $(".timechart-view").append($timechartViewBlock);
        }
        $("[data-toggle=tooltip]").tooltip({
          placement: "bottom",
          animation: false
        });
        _form_cancel = function() {
          var j, n;
          $(".timechart-pop").popover("hide").remove();
          for (j = n = 0; n < 60; j = ++n) {
            _timechartParent.children(".timechart-block-" + j).removeClass("timechart-block-selecting");
          }
          return form_cancel();
        };
        return _form_submit = function() {
          return form_submit();
        };
      });
    }

    return Timechart;

  })();

}).call(this);
